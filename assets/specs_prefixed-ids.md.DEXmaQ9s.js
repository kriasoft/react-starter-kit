import{_ as i,c as e,o as a,a6 as t}from"./chunks/framework.C7CfgHXo.js";const c=JSON.parse('{"title":"Prefixed CUID2 Database IDs","description":"","frontmatter":{},"headers":[],"relativePath":"specs/prefixed-ids.md","filePath":"specs/prefixed-ids.md","lastUpdated":1771411043000}'),d={name:"specs/prefixed-ids.md"};function n(l,s,h,r,p,o){return a(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="prefixed-cuid2-database-ids" tabindex="-1">Prefixed CUID2 Database IDs <a class="header-anchor" href="#prefixed-cuid2-database-ids" aria-label="Permalink to “Prefixed CUID2 Database IDs”">​</a></h1><p>All database primary keys use application-generated, prefixed <a href="https://github.com/paralleldrive/cuid2" target="_blank" rel="noreferrer">CUID2</a> identifiers: <code>usr_ght4k2jxm7pqbv01</code>. The prefix encodes entity type, improving debuggability across logs, URLs, and support conversations. Same pattern as Stripe (<code>cus_</code>, <code>sub_</code>), Clerk (<code>user_</code>, <code>org_</code>).</p><p>IDs are opaque strings – clients must not parse or decode them.</p><h2 id="format" tabindex="-1">Format <a class="header-anchor" href="#format" aria-label="Permalink to “Format”">​</a></h2><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>{prefix}_{body}        Example: usr_ght4k2jxm7pqbv01</span></span>
<span class="line"><span> └──3──┘ └─16─┘        20 chars total</span></span></code></pre></div><ul><li><strong>Prefix:</strong> 3-char lowercase entity type</li><li><strong>Body:</strong> 16-char CUID2 (alphanumeric, starts with letter)</li></ul><h2 id="prefix-map" tabindex="-1">Prefix Map <a class="header-anchor" href="#prefix-map" aria-label="Permalink to “Prefix Map”">​</a></h2><p>Defined in <code>db/schema/id.ts</code>. Keys are Better Auth model names (not table names).</p><table tabindex="0"><thead><tr><th>Model</th><th>Prefix</th><th>Notes</th></tr></thead><tbody><tr><td><code>user</code></td><td><code>usr</code></td><td></td></tr><tr><td><code>session</code></td><td><code>ses</code></td><td></td></tr><tr><td><code>account</code></td><td><code>idn</code></td><td>Maps to <code>identity</code> table via <code>account.modelName</code> config</td></tr><tr><td><code>verification</code></td><td><code>vfy</code></td><td></td></tr><tr><td><code>organization</code></td><td><code>org</code></td><td></td></tr><tr><td><code>member</code></td><td><code>mem</code></td><td></td></tr><tr><td><code>invitation</code></td><td><code>inv</code></td><td></td></tr><tr><td><code>passkey</code></td><td><code>pky</code></td><td></td></tr><tr><td><code>subscription</code></td><td><code>sub</code></td><td></td></tr></tbody></table><h2 id="api" tabindex="-1">API <a class="header-anchor" href="#api" aria-label="Permalink to “API”">​</a></h2><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { generateAuthId, generateId } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;@repo/db&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Auth tables – type-checked against the prefix map</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateAuthId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;usr_ght4k2jxm7pqbv01&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Non-auth tables – any 3-letter prefix</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generateId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;upl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;upl_m8xk3jvqp2wnba09&quot;</span></span></code></pre></div><p>Throws on unknown auth models or invalid prefixes. The CUID2 generator is lazy-initialized (no module-level side effects – safe for Workers isolates).</p><h2 id="integration-points" tabindex="-1">Integration Points <a class="header-anchor" href="#integration-points" aria-label="Permalink to “Integration Points”">​</a></h2><p><strong>Better Auth</strong> – <code>apps/api/lib/auth.ts</code>:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">advanced</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    generateId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateAuthId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre></div><p><strong>Drizzle schema</strong> – <code>db/schema/*.ts</code> use <code>.$defaultFn()</code> instead of <code>gen_random_uuid()</code>:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">primaryKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$defaultFn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateAuthId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span></code></pre></div><h2 id="adding-a-new-model" tabindex="-1">Adding a New Model <a class="header-anchor" href="#adding-a-new-model" aria-label="Permalink to “Adding a New Model”">​</a></h2><ol><li>Add the prefix to <code>AUTH_PREFIX</code> in <code>db/schema/id.ts</code></li><li>Use <code>.$defaultFn(() =&gt; generateAuthId(&quot;modelName&quot;))</code> in the schema</li><li>Re-generate migrations: <code>bun db:generate</code></li></ol>`,19)])])}const g=i(d,[["render",n]]);export{c as __pageData,g as default};
