import{_ as t,c as a,o as i,a6 as s}from"./chunks/framework.C7CfgHXo.js";const b=JSON.parse('{"title":"Webhooks","description":"","frontmatter":{"outline":[2,3]},"headers":[],"relativePath":"billing/webhooks.md","filePath":"billing/webhooks.md","lastUpdated":0}'),o={name:"billing/webhooks.md"};function d(r,e,n,h,l,c){return i(),a("div",null,[...e[0]||(e[0]=[s('<h1 id="webhooks" tabindex="-1">Webhooks <a class="header-anchor" href="#webhooks" aria-label="Permalink to “Webhooks”">​</a></h1><p>The <code>@better-auth/stripe</code> plugin registers a webhook endpoint at <code>POST /api/auth/stripe/webhook</code> and handles signature verification, event parsing, and database updates automatically.</p><h2 id="events-handled" tabindex="-1">Events Handled <a class="header-anchor" href="#events-handled" aria-label="Permalink to “Events Handled”">​</a></h2><table tabindex="0"><thead><tr><th>Stripe Event</th><th>Plugin Action</th></tr></thead><tbody><tr><td><code>checkout.session.completed</code></td><td>Activates the subscription</td></tr><tr><td><code>customer.subscription.created</code></td><td>Records a new subscription</td></tr><tr><td><code>customer.subscription.updated</code></td><td>Syncs status, period dates, cancellation scheduling</td></tr><tr><td><code>customer.subscription.deleted</code></td><td>Marks the subscription as canceled</td></tr></tbody></table><p>The plugin updates the <code>subscription</code> table in the database — no manual event handling code is needed.</p><h2 id="stripe-dashboard-configuration" tabindex="-1">Stripe Dashboard Configuration <a class="header-anchor" href="#stripe-dashboard-configuration" aria-label="Permalink to “Stripe Dashboard Configuration”">​</a></h2><p>Register the webhook endpoint in <a href="https://dashboard.stripe.com/webhooks" target="_blank" rel="noreferrer">Stripe Dashboard → Webhooks</a>:</p><table tabindex="0"><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td>Endpoint URL</td><td><code>https://&lt;your-domain&gt;/api/auth/stripe/webhook</code></td></tr><tr><td>Events</td><td><code>checkout.session.completed</code>, <code>customer.subscription.created</code>, <code>customer.subscription.updated</code>, <code>customer.subscription.deleted</code></td></tr></tbody></table><p>Copy the signing secret (<code>whsec_...</code>) to <code>STRIPE_WEBHOOK_SECRET</code>.</p><h2 id="local-development" tabindex="-1">Local Development <a class="header-anchor" href="#local-development" aria-label="Permalink to “Local Development”">​</a></h2><p>Use the <a href="https://docs.stripe.com/stripe-cli" target="_blank" rel="noreferrer">Stripe CLI</a> to forward webhook events to your local dev server:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stripe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --forward-to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost:5173/api/auth/stripe/webhook</span></span></code></pre></div><p>The CLI prints a webhook signing secret (<code>whsec_...</code>) — copy it to your <code>.env.local</code>:</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STRIPE_WEBHOOK_SECRET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=whsec_...</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>The local signing secret changes each time you restart <code>stripe listen</code>. Update <code>.env.local</code> and restart the dev server if webhook verification fails.</p></div><h2 id="raw-body-handling" tabindex="-1">Raw Body Handling <a class="header-anchor" href="#raw-body-handling" aria-label="Permalink to “Raw Body Handling”">​</a></h2><p>Stripe webhook verification requires the raw (unparsed) request body. The plugin reads the body via <code>request.text()</code> before Hono&#39;s body parser runs, so no special middleware configuration is needed.</p><h2 id="production-setup" tabindex="-1">Production Setup <a class="header-anchor" href="#production-setup" aria-label="Permalink to “Production Setup”">​</a></h2><p>Store the webhook secret as a Cloudflare Worker secret:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> put</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> STRIPE_WEBHOOK_SECRET</span></span></code></pre></div><p>After deploying, send a test event from the Stripe Dashboard to verify the endpoint is reachable and the signature validates correctly.</p>',21)])])}const k=t(o,[["render",d]]);export{b as __pageData,k as default};
