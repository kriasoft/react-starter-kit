import{_ as i,c as a,o as t,a6 as s}from"./chunks/framework.C7CfgHXo.js";const p=JSON.parse('{"title":"Migrations","description":"","frontmatter":{},"headers":[],"relativePath":"database/migrations.md","filePath":"database/migrations.md","lastUpdated":0}'),n={name:"database/migrations.md"};function r(o,e,d,l,h,g){return t(),a("div",null,[...e[0]||(e[0]=[s(`<h1 id="migrations" tabindex="-1">Migrations <a class="header-anchor" href="#migrations" aria-label="Permalink to “Migrations”">​</a></h1><p>Drizzle Kit generates SQL migrations by diffing your TypeScript schema against the latest snapshot. Migration files live in <code>db/migrations/</code> alongside a journal that tracks applied versions.</p><h2 id="workflow" tabindex="-1">Workflow <a class="header-anchor" href="#workflow" aria-label="Permalink to “Workflow”">​</a></h2><p><strong>1. Edit the schema</strong> in <code>db/schema/</code>.</p><p><strong>2. Generate a migration:</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:generate</span></span></code></pre></div><p>This produces a numbered SQL file (e.g., <code>0001_add_product_table.sql</code>) in <code>db/migrations/</code>.</p><p><strong>3. Review the generated SQL.</strong> Drizzle Kit&#39;s output is generally correct, but always check for destructive operations — column drops, type changes, or data loss.</p><p><strong>4. Apply the migration:</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:migrate</span></span></code></pre></div><p><strong>5. Verify in Drizzle Studio:</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:studio</span></span></code></pre></div><h2 id="push-vs-migrate" tabindex="-1">Push vs Migrate <a class="header-anchor" href="#push-vs-migrate" aria-label="Permalink to “Push vs Migrate”">​</a></h2><table tabindex="0"><thead><tr><th>Command</th><th>What it does</th><th>Use when</th></tr></thead><tbody><tr><td><code>bun db:migrate</code></td><td>Applies pending migration files in order</td><td>Production, staging, shared databases</td></tr><tr><td><code>bun db:push</code></td><td>Syncs schema directly, no migration files</td><td>Local development, rapid prototyping</td></tr></tbody></table><p><code>push</code> is faster during development since it skips migration file generation. Switch to <code>migrate</code> when you need reproducible, reviewable changes.</p><h2 id="targeting-environments" tabindex="-1">Targeting Environments <a class="header-anchor" href="#targeting-environments" aria-label="Permalink to “Targeting Environments”">​</a></h2><p>Append <code>:staging</code> or <code>:prod</code> to run against other databases:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:migrate:staging</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:migrate:prod</span></span></code></pre></div><p>These set <code>ENVIRONMENT</code> internally, which controls which <code>.env.{env}.local</code> file is loaded. Double-check the target before running migrations against production.</p><h2 id="drift-detection" tabindex="-1">Drift Detection <a class="header-anchor" href="#drift-detection" aria-label="Permalink to “Drift Detection”">​</a></h2><p>If schema files and migration snapshots diverge (e.g., after a manual DB change or a merge conflict), run:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db:check</span></span></code></pre></div><p>This reports discrepancies between your TypeScript schema and the migration history. Resolve by either updating the schema to match or generating a new migration to cover the gap.</p><h2 id="tips" tabindex="-1">Tips <a class="header-anchor" href="#tips" aria-label="Permalink to “Tips”">​</a></h2><ul><li><strong>Name your migrations</strong> — <code>bun db:generate --name add-product-table</code> produces clearer filenames than auto-numbered defaults.</li><li><strong>One concern per migration</strong> — avoid bundling unrelated schema changes. Smaller migrations are easier to review and roll back.</li><li><strong>Never edit applied migrations</strong> — if a migration has already run in staging or production, create a new migration to correct issues.</li><li><strong>Review before applying</strong> — <code>db:generate</code> writes SQL to disk. Read the file before running <code>db:migrate</code>.</li></ul>`,25)])])}const b=i(n,[["render",r]]);export{p as __pageData,b as default};
