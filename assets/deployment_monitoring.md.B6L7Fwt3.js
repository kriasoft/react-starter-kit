import{_ as i,c as a,o as e,a6 as t}from"./chunks/framework.C7CfgHXo.js";const k=JSON.parse('{"title":"Monitoring","description":"","frontmatter":{},"headers":[],"relativePath":"deployment/monitoring.md","filePath":"deployment/monitoring.md","lastUpdated":0}'),n={name:"deployment/monitoring.md"};function r(l,s,o,p,h,d){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="monitoring" tabindex="-1">Monitoring <a class="header-anchor" href="#monitoring" aria-label="Permalink to “Monitoring”">​</a></h1><p>Monitor your Workers in production using Cloudflare&#39;s built-in tools and roll back quickly when issues arise.</p><h2 id="wrangler-tail" tabindex="-1">Wrangler Tail <a class="header-anchor" href="#wrangler-tail" aria-label="Permalink to “Wrangler Tail”">​</a></h2><p>Stream live logs from any worker:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Tail production API logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/api/wrangler.jsonc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Filter to specific paths</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/api/wrangler.jsonc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --search-str=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/trpc&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Tail staging</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/api/wrangler.jsonc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --env=staging</span></span></code></pre></div><p>Logs include request metadata, <code>console.log</code> output, and uncaught exceptions.</p><h2 id="cloudflare-analytics" tabindex="-1">Cloudflare Analytics <a class="header-anchor" href="#cloudflare-analytics" aria-label="Permalink to “Cloudflare Analytics”">​</a></h2><p>The Cloudflare dashboard provides per-worker metrics:</p><ul><li><strong>Workers → Analytics</strong> — request count, error rate, CPU time, duration percentiles</li><li><strong>Workers → Logs</strong> — real-time and historical log streams</li><li>Set up <strong>notification policies</strong> for error rate spikes or latency increases</li></ul><h2 id="rollback" tabindex="-1">Rollback <a class="header-anchor" href="#rollback" aria-label="Permalink to “Rollback”">​</a></h2><p>If a deploy introduces issues, roll back to the previous version:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># List recent deployments</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deployments</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/api/wrangler.jsonc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Roll back to the previous stable version</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wrangler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rollback</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apps/api/wrangler.jsonc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --message=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Reverting due to auth regression&quot;</span></span></code></pre></div><p>Repeat for each affected worker (<code>apps/app/</code>, <code>apps/web/</code>).</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>Wrangler rollback reverts worker code but not database migrations. If a deploy included schema changes that the previous code depends on differently, you may need to deploy a fix-forward migration instead. See <a href="/database/migrations">Database: Migrations</a>.</p></div><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to “Troubleshooting”">​</a></h2><p><strong>Worker size limit</strong> — Cloudflare Workers have a 10 MB compressed size limit. If you hit it:</p><ul><li>Check for accidentally bundled dependencies</li><li>Move large assets to R2 storage</li><li>Ensure tree shaking is working (check for side-effect imports)</li></ul><p><strong>Database connection issues</strong> — If queries fail or time out:</p><ul><li>Verify Hyperdrive IDs in <code>wrangler.jsonc</code> match Terraform output</li><li>Check Neon dashboard for connection limit exhaustion</li><li>Confirm the database isn&#39;t in auto-suspended state (first request after suspend is slower)</li></ul><p><strong>Authentication problems</strong> — If sign-in fails in production:</p><ul><li>Verify <code>BETTER_AUTH_SECRET</code> is set (<code>wrangler secret list --config apps/api/wrangler.jsonc</code>)</li><li>Check <code>APP_ORIGIN</code> matches your actual domain (affects cookie domain)</li><li>Confirm OAuth redirect URIs include your production URL. See <a href="/auth/social-providers">Social Providers</a></li></ul><h2 id="cost-overview" tabindex="-1">Cost Overview <a class="header-anchor" href="#cost-overview" aria-label="Permalink to “Cost Overview”">​</a></h2><table tabindex="0"><thead><tr><th>Service</th><th>Free tier</th><th>Paid</th></tr></thead><tbody><tr><td>Cloudflare Workers</td><td>100,000 requests/day</td><td>$5/month for 10M requests</td></tr><tr><td>Neon PostgreSQL</td><td>0.5 GB storage, auto-suspend compute</td><td>Scale-to-zero billing</td></tr><tr><td>Hyperdrive</td><td>Included with Workers paid plan</td><td>—</td></tr></tbody></table><p>For most projects, the free tiers are sufficient through early production. Monitor usage in the Cloudflare and Neon dashboards as traffic grows.</p>`,24)])])}const g=i(n,[["render",r]]);export{k as __pageData,g as default};
